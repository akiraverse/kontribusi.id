// This is your Prisma schema file for PostgreSQL
// Learn more: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  volunteer
  organization
}

enum Gender {
  female
  male
}

enum ApplicationStatus {
  PENDING
  ACCEPTED
  REJECTED
  COMPLETED
}

model User {
  id       Int     @id @default(autoincrement())
  name     String
  email    String  @unique
  password String
  role     Role
  file     String?

  volunteerProfile    VolunteerProfile?
  organizationProfile OrganizationProfile?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("user")
}

model VolunteerProfile {
  id             Int       @id @default(autoincrement())
  location       String?
  dateOfBirth    DateTime? @map("date_of_birth")
  gender         Gender?
  availableDay   String[]  @map("available_day") // Array: ["Monday", "Tuesday", "Wednesday"]
  interests      String[]
  skills         String[]

  userId Int    @unique @map("user_id")
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  applications    Application[]
  portfolios      Portfolio[]
  availableTimes  AvailableTime[] @relation("VolunteerAvailableTimes")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("volunteer_profile")
}

model AvailableTime {
  id          Int      @id @default(autoincrement())
  timeFrom    String   @map("time_from") // e.g. "09:00"
  timeTo      String   @map("time_to")   // e.g. "10:00"

  // Usage tracking columns
  usageCountVolunteer   Int @default(0) @map("usage_count_volunteer")
  usageCountOpportunity Int @default(0) @map("usage_count_opportunity")

  // Many-to-many relations back to volunteer & opportunity
  volunteerProfiles  VolunteerProfile[]   @relation("VolunteerAvailableTimes")
  volunteerOpportunities VolunteerOpportunity[] @relation("OpportunityAvailableTimes")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("available_time")
}

model OrganizationProfile {
  id          Int       @id @default(autoincrement())
  name        String
  address     String?
  phone       String?
  description String?
  structure   String?

  userId Int    @unique @map("user_id")
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  opportunities   VolunteerOpportunity[]
  impactAnalyses  ImpactAnalysis[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("organization_profile")
}

model VolunteerOpportunity {
  id              Int    @id @default(autoincrement())
  title           String
  description     String?
  rules           String?
  location        String?
  startDate       DateTime @map("start_date")
  endDate         DateTime @map("end_date")
  category        String?
  capacity        Int
  requiredSkills  String[] @map("required_skills")
  matchingScore   Float?   @map("matching_score")

  organizationId Int                 @map("organization_id")
  organization   OrganizationProfile @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  applications Application[]
  availableTimes AvailableTime[] @relation("OpportunityAvailableTimes")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("volunteer_opportunity")
}

model Application {
  id          Int             @id @default(autoincrement())
  applyDate   DateTime          @default(now()) @map("apply_date")
  status      ApplicationStatus @default(PENDING)
  position    String            @default("")
  description String            @default("")

  volunteerId Int              @map("volunteer_id")
  volunteer   VolunteerProfile @relation(fields: [volunteerId], references: [id], onDelete: Cascade)

  opportunityId Int                  @map("opportunity_id")
  opportunity   VolunteerOpportunity @relation(fields: [opportunityId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("application")
}

model ImpactAnalysis {
  id              Int    @id @default(autoincrement())
  totalHours      Int      @map("total_hours")
  totalVolunteers Int      @map("total_volunteers")
  beneficiaries   Int
  regionCovered   String?  @map("region_covered")
  lastUpdated     DateTime @default(now()) @map("last_updated")

  organizationId Int                 @map("organization_id")
  organization   OrganizationProfile @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("impact_analysis")
}

model Portfolio {
  id                Int   @id @default(autoincrement())
  activityTitle     String  @map("activity_title")
  contributionHours Int     @map("contribution_hours")
  certificate       String? // URL or path to PDF file
  badge             String?
  feedback          String?

  volunteerId Int              @map("volunteer_id")
  volunteer   VolunteerProfile @relation(fields: [volunteerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("portfolio")
}